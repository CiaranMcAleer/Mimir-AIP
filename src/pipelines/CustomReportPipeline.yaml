pipelines:
  - name: Custom Report Pipeline
    enabled: true
    # No schedule field: run-once pipeline
    steps:
      # --- Aircraft Data Section ---
      - name: FetchAircraftData
        plugin: Input.ADSBdata
        config:
          lat: 54.6079
          lon: -5.9264
          radius: 25
          limit: 10
        output: aircraft_data
      - name: FormatAircraftData
        plugin: Data_Processing.AircraftDataFormatter
        config:
          input_key: aircraft_data
          output_key: aircraft_data_html
        output: aircraft_data_html

      # --- Traffic Camera Section ---
      - name: FetchTrafficCamera
        plugin: Input.TrafficWatchNIImage
        config:
          camera_id: 1  # Chichester Street, known-good from cache
          save_to_disk: true
        output: traffic_image_path
      - name: ImageToBase64
        plugin: Data_Processing.ImageToBase64
        config:
          input_key: traffic_image_path
          output_key: image_base64
        output: image_base64

      # --- Map Section ---
      - name: GenerateMap
        plugin: Output.LeafletJSmap
        config:
          title: "Custom Report Map"
          center: [54.6079, -5.9264]
          zoom: 6
          markers:
            - lat: 54.6079
              lon: -5.9264
              popup: "Belfast (Aircraft)"
            - lat: 54.6079
              lon: -5.9264
              popup: "Traffic Camera"
          export_mode: embed
        output: map_html

      # --- Bloomberg Section ---
      - name: FetchBloombergNews
        plugin: Input.bloomberg
        config:
          params:
            token: "glassdoor:gd4bloomberg"
            ageHours: 120
            limit: 3
        output: bloomberg
      - name: FormatBloombergNews
        plugin: Data_Processing.GeneralFormatter
        config:
          input_key: bloomberg
          output_key: bloomberg_html
          format: html_list
          title_key: title
          link_key: link
          body_key: summary
          max_items: 5
        output: bloomberg_html

      # --- RSS Section (BBC News World) ---
      - name: FetchRSSFeed
        plugin: Input.rss_feed
        config:
          url: "http://feeds.bbci.co.uk/news/world/rss.xml"
          limit: 5
        output: rss_feed
      - name: FormatRSSFeed
        plugin: Data_Processing.GeneralFormatter
        config:
          input_key: rss_feed
          output_key: rss_feed_html
          format: html_list
          title_key: title
          link_key: link
          max_items: 5
        output: rss_feed_html

      # --- WhiteHousePressPool Section ---
      - name: FetchWhiteHouseReport
        plugin: Input.WhiteHousePressPool
        config:
          limit: 3
        output: wh_report
      - name: FormatWhiteHouseReport
        plugin: Data_Processing.GeneralFormatter
        config:
          input_key: wh_report
          output_key: wh_report_html
          format: html_list
          title_key: headline
          body_key: body
          max_items: 5
        output: wh_report_html

      # --- HTML Report Generation ---
      - name: GenerateHTMLReport
        plugin: Output.HTMLReport
        config:
          title: "Custom Mimir-AIP Report"
          output_dir: "reports"
          filename: "custom_report.html"
          sections:
            - heading: "Aircraft Data"
              text: "{aircraft_data_html}"
            - heading: "Traffic Camera Image"
              text: "<img src='data:image/jpeg;base64,{image_base64}' />"
            - heading: "Map"
              text: "{map_html}"
            - heading: "Bloomberg News"
              text: "{bloomberg_html}"
            - heading: "BBC World RSS Headlines"
              text: "{rss_feed_html}"
            - heading: "White House Press Pool"
              text: "{wh_report_html}"
        output: html_report_path
